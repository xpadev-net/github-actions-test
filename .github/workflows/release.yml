on:
  release:
    types: [published]

env:
  DISCORD: ${{ secrets.discord }}
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: |
          echo '${{github.event.release.body}}' > body.txt
          BODY=`more body.txt`
          sed --in-place --expression='s/\n/\\r/' ./body.txt
          sed --in-place --expression='s/<title>/${{github.event.release.name}}/' ./message.json
          sed --in-place --expression="s/<body>/$BODY/" ./message.json
          sed --in-place --expression='s/\n/ /' ./message.json
      - run: |
          JSON=$(cat ./message.json)
          curl -X POST -F 'payload_json=$JSON' "$DISCORD"
        env:
          DISCORD: ${{secrets.DISCORD}}